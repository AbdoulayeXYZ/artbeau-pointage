# Guide de D√©ploiement SSL - Art'Beau Pointage

## üåê Configuration du Domaine

Votre application est configur√©e pour utiliser le domaine : **pointage.artbeaurescence.sn**

### ‚úÖ V√©rification DNS

Assurez-vous que votre domaine pointe vers l'IP du serveur :
```bash
nslookup pointage.artbeaurescence.sn
```

Le r√©sultat doit afficher : `51.68.45.161`

## üîê D√©ploiement SSL Automatique

### √âtape 1 : Pr√©paration

1. **V√©rifiez que tous les fichiers sont pr√©sents :**
   ```bash
   ls -la *.conf *.sh
   ```

2. **Assurez-vous que les scripts sont ex√©cutables :**
   ```bash
   chmod +x deploy-ssl.sh start-nginx-ssl.sh
   ```

### √âtape 2 : D√©ploiement

Ex√©cutez le script de d√©ploiement SSL :
```bash
./deploy-ssl.sh
```

Ce script va :
- ‚úÖ Cr√©er une archive du projet
- ‚úÖ Copier les fichiers sur le serveur
- ‚úÖ V√©rifier la configuration DNS
- ‚úÖ Construire les conteneurs Docker
- ‚úÖ Configurer SSL automatiquement avec Let's Encrypt
- ‚úÖ D√©marrer l'application

### √âtape 3 : V√©rification

Apr√®s le d√©ploiement, v√©rifiez que tout fonctionne :

1. **Acc√®s HTTPS :**
   ```
   https://pointage.artbeaurescence.sn
   ```

2. **Health Check :**
   ```
   https://pointage.artbeaurescence.sn/health
   ```

3. **Redirection HTTP ‚Üí HTTPS :**
   ```
   http://pointage.artbeaurescence.sn
   ```
   (doit rediriger automatiquement vers HTTPS)

## üîß Configuration Technique

### Variables d'Environnement

**Backend (.env.production) :**
```env
NODE_ENV=production
PORT=3001
JWT_SECRET=your-super-secret-jwt-key-here-please-change-this
CORS_ORIGIN=https://pointage.artbeaurescence.sn,http://pointage.artbeaurescence.sn
```

**Frontend (frontend/.env.production) :**
```env
VITE_API_URL=https://pointage.artbeaurescence.sn/api
VITE_SOCKET_URL=https://pointage.artbeaurescence.sn
```

### Architecture SSL

```
Internet ‚Üí HTTPS (443) ‚Üí Nginx ‚Üí Frontend (React)
                    ‚Üì
                Backend (Node.js) ‚Üê API Calls
```

### Certificats SSL

- **Fournisseur :** Let's Encrypt
- **Renouvellement :** Automatique (90 jours)
- **Validation :** HTTP-01 Challenge
- **S√©curit√© :** TLS 1.2/1.3, HSTS activ√©

## üõ†Ô∏è Commandes Utiles

### V√©rification des Services

```bash
# Voir les logs en temps r√©el
ssh ubuntu@51.68.45.161 'cd /opt/artbeau-pointage/current && docker-compose -f docker-compose.prod.yml logs -f'

# V√©rifier le statut des conteneurs
ssh ubuntu@51.68.45.161 'cd /opt/artbeau-pointage/current && docker-compose -f docker-compose.prod.yml ps'

# Red√©marrer les services
ssh ubuntu@51.68.45.161 'cd /opt/artbeau-pointage/current && docker-compose -f docker-compose.prod.yml restart'
```

### Gestion SSL

```bash
# V√©rifier les certificats SSL
ssh ubuntu@51.68.45.161 'docker exec artbeau_frontend certbot certificates'

# Renouveler manuellement les certificats
ssh ubuntu@51.68.45.161 'docker exec artbeau_frontend certbot renew'

# Tester la configuration SSL
curl -I https://pointage.artbeaurescence.sn
```

### Maintenance

```bash
# Sauvegarder la base de donn√©es
ssh ubuntu@51.68.45.161 'cd /opt/artbeau-pointage/current && docker exec artbeau_backend sqlite3 /app/data/artbeau.db ".backup /app/data/backup-$(date +%Y%m%d-%H%M%S).db"'

# Nettoyer les anciennes images Docker
ssh ubuntu@51.68.45.161 'docker image prune -f'

# V√©rifier l'espace disque
ssh ubuntu@51.68.45.161 'df -h'
```

## üîí S√©curit√©

### Headers de S√©curit√© Configur√©s

- **HSTS :** `max-age=31536000; includeSubDomains`
- **X-Frame-Options :** `SAMEORIGIN`
- **X-Content-Type-Options :** `nosniff`
- **X-XSS-Protection :** `1; mode=block`
- **Referrer-Policy :** `strict-origin-when-cross-origin`

### CORS Configuration

```javascript
// Backend CORS
CORS_ORIGIN=https://pointage.artbeaurescence.sn,http://pointage.artbeaurescence.sn
```

### Rate Limiting

- **Window :** 15 minutes
- **Max Requests :** 1000 par IP
- **Protection :** Contre les attaques DDoS

## üö® D√©pannage

### Probl√®mes Courants

1. **Certificat SSL non g√©n√©r√© :**
   ```bash
   ssh ubuntu@51.68.45.161 'docker exec artbeau_frontend certbot --nginx --domains pointage.artbeaurescence.sn'
   ```

2. **Application non accessible :**
   ```bash
   ssh ubuntu@51.68.45.161 'cd /opt/artbeau-pointage/current && docker-compose -f docker-compose.prod.yml logs --tail=100'
   ```

3. **DNS non propag√© :**
   ```bash
   nslookup pointage.artbeaurescence.sn
   # Attendre 24-48h pour la propagation compl√®te
   ```

4. **Ports bloqu√©s :**
   ```bash
   # V√©rifier que les ports 80 et 443 sont ouverts
   ssh ubuntu@51.68.45.161 'sudo netstat -tlnp | grep :80'
   ssh ubuntu@51.68.45.161 'sudo netstat -tlnp | grep :443'
   ```

### Logs Importants

```bash
# Logs Nginx
ssh ubuntu@51.68.45.161 'docker exec artbeau_frontend tail -f /var/log/nginx/error.log'

# Logs Backend
ssh ubuntu@51.68.45.161 'docker exec artbeau_backend tail -f /app/logs/artbeau.log'

# Logs Certbot
ssh ubuntu@51.68.45.161 'docker exec artbeau_frontend tail -f /var/log/letsencrypt/letsencrypt.log'
```

## üìû Support

En cas de probl√®me :

1. **V√©rifiez les logs** avec les commandes ci-dessus
2. **Testez l'accessibilit√©** : `curl -I https://pointage.artbeaurescence.sn`
3. **V√©rifiez le DNS** : `nslookup pointage.artbeaurescence.sn`
4. **Red√©marrez les services** si n√©cessaire

---

**üéâ Votre application Art'Beau Pointage est maintenant s√©curis√©e avec SSL !**
